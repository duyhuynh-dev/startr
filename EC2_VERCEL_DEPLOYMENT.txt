â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘      AWS EC2 + VERCEL DEPLOYMENT (Using AWS Credits!)       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

COST: FREE with your AWS credits! ğŸ‰


STEP 1: CREATE EC2 INSTANCE
============================
1. Go to: https://console.aws.amazon.com/ec2
2. Click "Launch Instance"
3. Configure:
   - Name: vc-matcher-backend (or your choice)
   - AMI: Ubuntu Server 22.04 LTS (free tier eligible)
   - Instance Type: t2.micro (free tier) or t2.small (recommended)
   - Key Pair: Create new or select existing (SAVE THE .pem FILE!)
   - Network Settings: 
     * Click "Edit"
     * Allow SSH from "My IP" (port 22)
     * Click "Add security group rule":
       - Type: Custom TCP
       - Port: 8000
       - Source: 0.0.0.0/0 (or your IP for security)
     * Click "Save"
   - Storage: 20GB gp3 (free tier gets 30GB)
   - Click "Launch Instance"

STEP 2: CONNECT TO EC2 INSTANCE
================================
Option A - AWS Console (Easiest):
1. Go to EC2 â†’ Instances
2. Select your instance
3. Click "Connect" â†’ "EC2 Instance Connect" â†’ "Connect"

Option B - SSH from Terminal:
# Replace with your key and IP
ssh -i ~/your-key.pem ubuntu@YOUR_EC2_PUBLIC_IP

STEP 3: INSTALL DOCKER
======================
# Update system
sudo apt update && sudo apt upgrade -y

# Install Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker ubuntu

# Install Docker Compose
sudo apt install docker-compose git -y

# Log out and back in for docker group to take effect
exit

STEP 4: CLONE YOUR REPO
========================
# SSH back in, then:
cd ~
git clone YOUR_GITHUB_REPO_URL
cd ambitious-project/backend
cp .env.example .env
nano .env  # Fill in your passwords

STEP 5: GENERATE PASSWORDS
===========================
# Generate secure passwords
cd ~/ambitious-project/backend
./generate-passwords.sh

# Copy the output into your .env file
nano .env

STEP 6: CONFIGURE ENVIRONMENT
==============================
In backend/.env, set at minimum:

POSTGRES_PASSWORD=your-password
REDIS_PASSWORD=your-password
SECRET_KEY=your-secret-key
MINIO_ROOT_PASSWORD=your-password

# CORS - Will set to Vercel URL after deployment
# For now, leave as default or set to your IP:
# CORS_ORIGINS=["http://YOUR_EC2_IP:3000"]

# Optional: Use AWS S3 instead of MinIO
# STORAGE_TYPE=s3
# AWS_ACCESS_KEY_ID=your-key
# AWS_SECRET_ACCESS_KEY=your-secret
# AWS_S3_BUCKET=your-bucket-name
# AWS_REGION=us-east-1

STEP 7: DEPLOY BACKEND
======================
cd ~/ambitious-project
./deploy-ec2.sh

STEP 8: GET YOUR EC2 PUBLIC IP
===============================
1. Go to EC2 Console â†’ Instances
2. Find your instance
3. Copy the "Public IPv4 address"
   This is your backend URL: http://YOUR_EC2_IP:8000

STEP 9: CONFIGURE SECURITY GROUP (Important!)
==============================================
1. Go to EC2 â†’ Instances â†’ Select your instance
2. Click "Security" tab â†’ Click Security Group name
3. Click "Edit inbound rules"
4. Verify these rules exist:
   - SSH (22) from your IP or My IP
   - Custom TCP (8000) from 0.0.0.0/0 (or your IP)
5. Click "Save rules"

If port 8000 is not open, add it:
- Click "Add rule"
- Type: Custom TCP
- Port: 8000
- Source: 0.0.0.0/0 (or specific IP for security)
- Click "Save rules"

STEP 10: TEST BACKEND
======================
# From your local computer:
curl http://YOUR_EC2_IP:8000/healthz

# Should return: {"status": "ok"}

# Or visit in browser:
http://YOUR_EC2_IP:8000/api/v1/docs


STEP 11: DEPLOY FRONTEND TO VERCEL
===================================
1. Go to: https://vercel.com
2. Sign up/login with GitHub
3. Click "Add New" â†’ "Project"
4. Import your repository
5. Configure:
   - Framework Preset: Next.js
   - Root Directory: frontend
   - Build Command: npm run build (or leave default)
   - Output Directory: .next (or leave default)

6. Add Environment Variables:
   NEXT_PUBLIC_API_URL=http://YOUR_EC2_IP:8000/api/v1
   NEXT_PUBLIC_WS_URL=ws://YOUR_EC2_IP:8000/api/v1/realtime/ws

7. Click "Deploy"

8. Wait for deployment to complete
9. Copy your Vercel URL (e.g., your-app.vercel.app)


STEP 12: UPDATE CORS AFTER VERCEL DEPLOY
=========================================
Once Vercel gives you a URL:

1. SSH into EC2:
   ssh -i ~/your-key.pem ubuntu@YOUR_EC2_IP

2. Edit backend/.env:
   cd ~/ambitious-project/backend
   nano .env
   # Update:
   CORS_ORIGINS=["https://your-app.vercel.app"]
   FRONTEND_URL=https://your-app.vercel.app

3. Restart backend:
   cd ~/ambitious-project
   docker-compose -f docker-compose.prod.yml restart backend


OPTIONAL: USE AWS S3 FOR STORAGE
=================================
Instead of MinIO, use AWS S3 (first 5GB free):

1. Go to S3 Console â†’ Create bucket
2. Go to IAM â†’ Users â†’ Create user
3. Attach policy: AmazonS3FullAccess (or create custom policy)
4. Create access key â†’ Save credentials
5. Add to backend/.env:
   STORAGE_TYPE=s3
   AWS_ACCESS_KEY_ID=your-access-key-id
   AWS_SECRET_ACCESS_KEY=your-secret-access-key
   AWS_S3_BUCKET=your-bucket-name
   AWS_REGION=us-east-1

6. Restart backend:
   docker-compose -f docker-compose.prod.yml restart backend


TROUBLESHOOTING
===============
Can't connect to backend?
- Check Security Group allows port 8000
- Verify EC2 instance is running
- Check: curl http://YOUR_EC2_IP:8000/healthz

Backend won't start?
- Check logs: docker-compose -f docker-compose.prod.yml logs backend
- Verify .env file has all required values
- Check disk space: df -h

Frontend can't connect?
- Check CORS_ORIGINS includes your Vercel URL
- Verify backend IP is correct in Vercel env vars
- Check Security Group allows connections

Connection timeout?
- EC2 Security Group must allow port 8000
- Try: curl -v http://YOUR_EC2_IP:8000/healthz

Out of memory?
- Upgrade to t2.small or t3.small instance
- Or disable ML: ML_ENABLED=false in .env


USEFUL COMMANDS
===============
# Check service status
docker-compose -f docker-compose.prod.yml ps

# View logs
docker-compose -f docker-compose.prod.yml logs -f backend

# Restart services
docker-compose -f docker-compose.prod.yml restart

# Update code
git pull
docker-compose -f docker-compose.prod.yml up -d --build

# Check disk space
df -h

# Check memory usage
free -h


That's it! You're deployed using your AWS credits! ğŸ‰

